<!-- preview.wxml -->
<view class="preview-container">
  <!-- 图片预览区域 -->
  <scroll-view class="preview-scroll" scroll-y>
    <!-- 确保canvas正确渲染，添加明确的宽高样式 -->
    <canvas type="2d" id="previewCanvas" class="preview-canvas" style="width: {{canvasWidth}}px; height: {{canvasHeight}}px;"></canvas>
    

    <!-- 加载指示器 -->
    <view class="loading-container" wx:if="{{isRendering}}">
      <view class="loading-spinner"></view>
      <view class="loading-text">正在渲染 ({{renderProgress}}%)</view>
      <view class="progress-bar">
        <view class="progress-inner" style="width: {{renderProgress}}%;"></view>
      </view>
      <!-- 重试按钮 -->
      <view class="retry-button" bindtap="retryRendering">重新渲染</view>
    </view>
  </scroll-view> <!-- 添加 scroll-view 结束标签 -->


  <!-- 底部操作区 -->
  <view class="bottom-area">
    <!-- 主要操作按钮 -->
    <view class="action-buttons">
      <view class="action-btn" bindtap="changeTemplate">
        <image class="btn-icon" src="/assets/icons/template.png" />
        <text>更换模板</text>
      </view>
      <view class="action-btn" bindtap="saveImage">
        <image class="btn-icon" src="/assets/icons/save.png" />
        <text>保存相册</text>
      </view>
      <view class="action-btn" bindtap="shareToFriends">
        <image class="btn-icon" src="/assets/icons/share.png" />
        <text>分享给好友</text>
      </view>
      <view class="action-btn" bindtap="shareToMoments">
        <image class="btn-icon" src="/assets/icons/moments.png" />
        <text>分享到朋友圈</text>
      </view>
      <view class="action-btn" bindtap="retryRendering">
        <image class="btn-icon" src="/assets/icons/refresh.png" />
        <text>重新渲染</text>
      </view>
    </view>

    <!-- 水印开关 -->
    <view class="watermark-switch">
      <text>添加"由文图生成"水印</text>
      <switch checked="{{showWatermark}}" bindchange="toggleWatermark" color="#4080ff" />
    </view>
  </view>
</view> 